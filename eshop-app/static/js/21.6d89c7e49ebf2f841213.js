webpackJsonp([21],{"5nOW":function(t,s){},"5oDv":function(t,s){},DbdG:function(t,s,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=n("Dd8w"),e=n.n(i),a={name:"use_integral",data:function(){return{useIntegral:"",currentVisible:!1,transition:!1}},props:{value:!0,point:{total_point:0,point_setting:1,rule_name:""}},methods:{handleVisible:function(){this.currentVisible=!1},usePoint:function(){if(parseInt(this.useIntegral)>parseInt(this.point.total_point))return this.$myToast("积分不够"),!1;this.$emit("usePointCallback",this.useIntegral),this.transition=!1}},watch:{value:function(t){var s=this;this.currentVisible=t,t&&setTimeout(function(){s.transition=t},20)},transition:function(t){var s=this;t||setTimeout(function(){s.currentVisible=t},300)},currentVisible:function(t){this.$emit("input",t)},useIntegral:function(t){this.useIntegral=parseInt(t)>0&&parseInt(t)>parseInt(this.point.total_point)?this.point.total_point:t}},mounted:function(){this.value&&(this.currentVisible=!0),this.$refs._useIntegral.style.height=window.innerHeight+"px"}},o={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.currentVisible,expression:"currentVisible === true"}],ref:"_useIntegral",staticClass:"use-integral",on:{hidden:t.handleVisible}},[i("transition",{attrs:{name:"fade"}},[t.transition?i("div",{staticClass:"mask",on:{click:function(s){t.transition=!1}}}):t._e()]),t._v(" "),i("transition",{attrs:{name:"slide"}},[t.transition?i("div",{staticClass:"main"},[i("i",{staticClass:"close",on:{click:function(s){t.transition=!1}}},[i("img",{attrs:{src:n("Rn3x")}})]),t._v(" "),i("h4",{staticClass:"title"},[t._v("\n        使用积分\n      ")]),t._v(" "),i("p",{staticClass:"usable"},[t._v("\n        可用积分："+t._s(t.point.total_point)+"\n      ")]),t._v(" "),i("div",{staticClass:"in-wrapper"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.useIntegral,expression:"useIntegral"}],attrs:{type:"tel"},domProps:{value:t.useIntegral},on:{input:function(s){s.target.composing||(t.useIntegral=s.target.value)}}})]),t._v(" "),i("p",{staticClass:"tip"},[t._v("积分规则："+t._s(t.point.rule_name))]),t._v(" "),i("button",{staticClass:"confirm",on:{click:t.usePoint}},[t._v("确定")])]):t._e()])],1)},staticRenderFns:[]};var r=n("VU/8")(a,o,!1,function(t){n("5nOW")},"data-v-63a19eb6",null).exports,c=n("7i5E"),u={name:"use_coupon",data:function(){return{useCoupon:"",currentVisible:!1,transition:!1}},props:{value:!0,coupons:{type:Array},totalAmount:{type:Number}},components:{CouponsList:c.a},methods:{handleVisible:function(){this.currentVisible=!1},queryCoupon:function(t){var s=this;this.$http.post(this.API.order.coupon_query,{total_money:this.totalAmount,code:t.code}).then(function(n){"0000"==n.return_code?(s.transition=!1,s.$emit("useCouponCallback",{coupon:t,discount:n.data.detail.extra.consume_amount})):s.$myToast(n.return_msg)})},cancelUse:function(){this.transition=!1,this.$emit("cancelUseCouponCallback")}},watch:{value:function(t){var s=this;this.currentVisible=t,t&&setTimeout(function(){s.transition=t},20)},transition:function(t){var s=this;t||setTimeout(function(){s.currentVisible=t},300)},currentVisible:function(t){this.$emit("input",t)}},mounted:function(){this.value&&(this.currentVisible=!0),this.$refs._useCoupon.style.height=window.innerHeight+"px"}},l={render:function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.currentVisible,expression:"currentVisible === true"}],ref:"_useCoupon",staticClass:"use-coupon",on:{hidden:t.handleVisible}},[n("transition",{attrs:{name:"fade"}},[t.transition?n("div",{staticClass:"mask",on:{click:function(s){t.transition=!1}}}):t._e()]),t._v(" "),n("transition",{attrs:{name:"slide"}},[t.transition?n("div",{staticClass:"main"},[n("h4",{staticClass:"title"},[t._v("使用优惠券")]),t._v(" "),n("div",{staticClass:"scroll-wrapper"},[n("coupons-list",{attrs:{"need-load":!1,"coupon-list":t.coupons},on:{cancelUseCoupon:t.cancelUse,useCoupon:t.queryCoupon}})],1)]):t._e()])],1)},staticRenderFns:[]};var p=n("VU/8")(u,l,!1,function(t){n("i1cw")},"data-v-853616be",null).exports,_=n("NYxO"),m={name:"quick_meal_confirm",data:function(){return{useAddrViewVisible:!1,useIntegralViewVisible:!1,useCouponsViewVisible:!1,score:0,couponCode:"",couponDiscount:0,couponName:"",point:{total_point:0,point_setting:1},coupons:[],featuresViewVisible:!1}},components:{UseIntegral:r,UseCoupons:p},mounted:function(){this.getConfirmPayInfo()},beforeDestroy:function(){clearInterval(this.deskStatusTimer)},computed:e()({},Object(_.c)({storeId:function(t){return t.common.common_data.store_info.store_id},storeName:function(t){return t.common.common_data.store_info.store_name},storeLogo:function(t){return t.common.common_data.store_info.store_log},lvName:function(t){return t.user.user_info.lv_name},cartList:function(t){return t.cart.cart.cartList}}),{totalData:function(){var t=0,s=0,n=0;return this.$store.state.cart.cart.cartList.forEach(function(i){n+=parseInt(i.num),t+=i.price*i.num,s+=(i.price-i.member_price)*i.num,i.adjunct.forEach(function(n){t+=n.price*n.num,s+=(n.price-n.member_price)*n.num})}),{num:n,total:this.NP.round(t,2),discount:this.NP.round(s,2)}},total_amount:function(){var t=0;return this.$store.state.cart.cart.cartList.forEach(function(s){t+=parseFloat(s.member_price*s.num),s.adjunct.forEach(function(s){t+=parseFloat(s.member_price*s.num)})}),this.NP.round(t,2)},pay_amount:function(){var t=0;return this.$store.state.cart.cart.cartList.forEach(function(s){t+=parseFloat(s.member_price*s.num),s.adjunct.forEach(function(s){t+=parseFloat(s.member_price*s.num)})}),t-=this.score*this.point.point_rate,t-=this.couponDiscount,t=t>0?t:0,this.NP.round(t,2)}}),methods:e()({},Object(_.b)(["clearCart"]),{getConfirmPayInfo:function(){var t=this,s=this.$store.state.common.common_data.store_info.store_id;this.$http.post(this.API.order.out_confirm_pay,{store_id:s,total_amount:this.total_amount}).then(function(s){"0000"==s.return_code?(t.point=s.data.point,t.coupons=s.data.coupon):t.$myToast(s.return_msg)})},showUsebleIntegral:function(){2==this.point.point_setting&&this.point.total_point>0?this.useIntegralViewVisible=!0:this.$myToast("没有可用积分或者商户未开启积分抵扣")},showUsableCoupon:function(){if(0===this.coupons.length)return!1;this.useCouponsViewVisible=!0},useScore:function(t){this.score=t},useCoupon:function(t){this.couponCode=t.coupon.code,this.couponDiscount=t.discount,"CASH"===t.coupon.card_type?t.coupon.least_cost>0?this.couponName="满减券"+parseInt(t.coupon.reduce_cost)+"元":this.couponName="代金券"+parseInt(t.coupon.reduce_cost)+"元":"DISCOUNT"===t.coupon.card_type&&(this.couponName="折扣券"+(100-t.coupon.discount)/10+"折")},cancelUseCoupon:function(){this.couponCode="",this.couponDiscount=0},goPay:function(){var t=this,s={payment:"wxpaynative"};this.score>0&&(s.score=this.score),this.couponCode&&(s.coupon=this.couponCode),s.store_id=this.storeId;var n=this.cartList;if(0===n.length)return this.$myToast("购物车不能为空"),!1;var i=[];n.forEach(function(t){var s={};s.goods_bn=t.bn,s.num=t.num,s.taste=t.taste;var n=[];t.adjunct.forEach(function(t){var s={goods_bn:t.goods_bn,num:t.num};n.push(s)}),s.adjunct=n,i.push(s)}),s.dishes=i,this.$http.post(this.API.order.quick_create,s).then(function(s){if("200"==s.return_code)t.clearCart(t.storeId),t.$router.push("/pay_success/"+s.data.order_id);else{if("0000"!=s.return_code)return void t.$myToast(s.return_msg);t.clearCart(t.storeId),t.$router.push("/pay/"+s.data.order_id)}})},add:function(){this.$router.go(-1)}})},d={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"confirm-pay-page"},[i("div",{staticClass:"goods-ready-pay",style:{visibility:"visible"}},[i("div",{staticClass:"base-info"},[i("div",{staticClass:"l"},[(t.storeLogo,i("img",{attrs:{src:n("0ykN")}})),t._v(" "),i("span",{staticClass:"title"},[t._v(t._s(t.storeName))])])]),t._v(" "),i("div",{staticClass:"goods-category"},[i("ul",{staticClass:"goods-list"},t._l(t.cartList,function(s,e){return i("li",[s.image_url?i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s.image_url,expression:"item.image_url"}],staticClass:"goods-pic"}):i("img",{staticClass:"goods-pic",attrs:{src:n("3Cyy")}}),t._v(" "),i("div",{staticClass:"goods-info"},[i("div",{staticClass:"l"},[i("p",{staticClass:"goods-name"},[t._v(t._s(t._f("longStrFormat")(s.name,17))),i("span",{staticClass:"unit"},[t._v("/"+t._s(s.unit))])]),t._v(" "),i("p",{staticClass:"adjuncts"},[s.taste.length>0?[t._l(s.taste,function(n,e){return t._l(n.items,function(n,e){return i("span",[t._v("\n                      "+t._s(n.props_name)+"\n                      "),[t._v(t._s(e===s.taste.length-1?"；":"，"))]],2)})})]:t._e(),t._v(" "),s.adjunct.length>0?t._l(s.adjunct,function(n,e){return i("span",[t._v("\n                      "+t._s(n.name+"×"+n.num)+"\n                      "),[t._v(t._s(e===s.adjunct.length-1?"；":"，"))]],2)}):t._e()],2)]),t._v(" "),i("div",{staticClass:"r"},[i("div",{staticClass:"price"},[i("p",{staticClass:"finally-price"},[t._v("￥"+t._s(t._f("formatActualMoney")(s.member_price)))]),t._v(" "),t.NP.round(parseFloat(s.price)-parseFloat(s.member_price),2)>0?i("p",{staticClass:"original-price"},[t._v("￥"+t._s(t._f("formatActualMoney")(s.price)))]):t._e()])]),t._v(" "),i("p",{staticClass:"single-total"},[t._v("×"+t._s(s.num))])])])}))]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"sum-up"},[i("div",{staticClass:"l"},[t._v("\n        商品共"+t._s(t.totalData.num)+"份\n      ")]),t._v(" "),i("div",{staticClass:"r"},[i("div",{staticClass:"member-discount"},[i("div",{staticClass:"member-label"},[t._v(t._s(t.lvName))]),t._v(" "),i("div",{staticClass:"discount-amount"},[i("span",{staticClass:"txt"},[t._v("已优惠")]),t._v(" "),i("span",{staticClass:"num"},[t._v("￥"+t._s(t._f("formatActualMoney")(t.totalData.discount)))])])]),t._v(" "),i("div",{staticClass:"lump-sum"},[i("span",{staticClass:"txt"},[t._v("小计")]),t._v(" "),i("span",{staticClass:"num"},[t._v("￥"+t._s(t._f("formatActualMoney")(t.totalData.total)))])])])])]),t._v(" "),i("div",{staticClass:"deduction"},[i("div",{staticClass:"coupon",on:{click:t.showUsableCoupon}},[i("span",{staticClass:"label"},[t._v("\n        优惠券\n      ")]),t._v(" "),i("div",{staticClass:"r"},[t.couponCode?i("span",{staticClass:"usable"},[t._v("\n          "+t._s(t.couponName)+"\n        ")]):0===t.coupons.length?i("span",{staticClass:"unusable"},[t._v("\n          无可用的优惠券\n        ")]):i("span",{staticClass:"useble"},[t._v("\n          "+t._s(t.coupons.length)+"张\n        ")]),t._v(" "),i("img",{attrs:{src:n("FXWK")}})])]),t._v(" "),i("div",{staticClass:"integral"},[i("span",{staticClass:"label"},[t._v("积分")]),t._v(" "),i("div",{staticClass:"r",on:{click:t.showUsebleIntegral}},[t.score?i("span",{staticClass:"usable"},[t._v("\n          已使用"+t._s(t.score)+"积分\n        ")]):i("span",{staticClass:"unusable"},[t._v("\n          未使用积分（"+t._s(t.point.total_point)+"可用）\n        ")]),t._v(" "),i("img",{attrs:{src:n("FXWK")}})])])]),t._v(" "),i("div",{staticClass:"floating"},[i("div",{staticClass:"features"},[i("div",{staticClass:"title",on:{click:t.add}},[i("img",{staticClass:"icon",attrs:{src:n("kB4+")}}),t._v("\n        加菜\n      ")])]),t._v(" "),i("div",{staticClass:"wait-pay"},[i("div",{staticClass:"lump-sum"},[i("span",[t._v("合计")]),t._v(" "),i("span",{staticClass:"amount"},[t._v("￥"+t._s(t._f("formatActualMoney")(t.pay_amount)))])]),t._v(" "),i("button",{on:{click:t.goPay}},[t._v("提交订单")])])]),t._v(" "),i("use-integral",{attrs:{point:t.point},on:{usePointCallback:t.useScore},model:{value:t.useIntegralViewVisible,callback:function(s){t.useIntegralViewVisible=s},expression:"useIntegralViewVisible"}}),t._v(" "),i("use-coupons",{attrs:{"total-amount":t.total_amount,coupons:t.coupons},on:{cancelUseCouponCallback:t.cancelUseCoupon,useCouponCallback:t.useCoupon},model:{value:t.useCouponsViewVisible,callback:function(s){t.useCouponsViewVisible=s},expression:"useCouponsViewVisible"}})],1)},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"remark"},[s("span",[this._v("备注：")])])}]};var v=n("VU/8")(m,d,!1,function(t){n("5oDv")},"data-v-e2026a9a",null);s.default=v.exports},i1cw:function(t,s){}});
//# sourceMappingURL=21.6d89c7e49ebf2f841213.js.map